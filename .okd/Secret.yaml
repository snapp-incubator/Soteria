apiVersion: v1
kind: Template
metadata:
  name: "${SERVICE_NAME}-secret"
objects:
  - apiVersion: v1
    kind: Secret
    type: Opaque
    metadata:
      name: "${SERVICE_NAME}-auth-env"
      labels:
        app: "${SERVICE_NAME}"
        app.snappcloud.io/managed-by: "${MANAGED_BY}"
        app.snappcloud.io/version: "${APP_VERSION}"
        app.snappcloud.io/instance: "${SERVICE_NAME}-${CI_COMMIT_REF_SLUG}"
    stringData:
      SOTERIA_JWT_KEYS_PATH: "${JWT_KEYS_PATH}"
      SOTERIA_DRIVER_SALT: "${DRIVER_HASH_SALT}"
      SOTERIA_PASSENGER_SALT: "${PASSENGER_HASH_SALT}"
      SOTERIA_DRIVER_HASH_LENGTH: "${DRIVER_HASH_LENGTH}"
      SOTERIA_PASSENGER_HASH_LENGTH: "${PASSENGER_HASH_LENGTH}"
  - apiVersion: v1
    kind: Secret
    type: Opaque
    metadata:
      name: "${SERVICE_NAME}-jwt-keys"
      labels:
        app: "${SERVICE_NAME}"
        app.snappcloud.io/managed-by: "${MANAGED_BY}"
        app.snappcloud.io/version: "${APP_VERSION}"
        app.snappcloud.io/instance: "${SERVICE_NAME}-${CI_COMMIT_REF_SLUG}"
    stringData:
      100.private.pem: "${THIRD_PARTY_JWT_PRIVATE_KEY}"

parameters:
  - name: SERVICE_NAME
    displayName: Service name
    description: The name of the application (should be unique in the namespace)
  - name: APP_VERSION
    required: true
  - name: MANAGED_BY
    displayName: Managed by
    required: true
    value: "dispatching-team"
  - name: CI_COMMIT_REF_SLUG
    displayName: Commit Ref Slug
    required: true
  - name: PASSENGER_HASH_SALT
    displayName: Passenger hash salt for HashIds
    required: true
  - name: PASSENGER_HASH_LENGTH
    displayName: Minimum length of passenger generated hash for HashIds
  - name: DRIVER_HASH_SALT
    displayName: Passenger hash salt for HashIds
    required: true
  - name: DRIVER_HASH_LENGTH
    displayName: Minimum length of driver generated hash for HashIds
  - name: JWT_KEYS_PATH
    displayName: Private Key Path
    description: Private key Path
    value: "/jwt_pems/"
    required: true
  - name: THIRD_PARTY_JWT_PRIVATE_KEY
    displayName: Third party Private Key
    description: Private key of third party's token
    required: true
    value: |-
        -----BEGIN RSA PRIVATE KEY-----
        MIICWwIBAAKBgQCTxwVGmWzJNOaZnBRL+9/V1Mc8OWWzUDxlG2kL+0WxHh8/+76n
        gIvp7YsHHxUadR0iY6NkzLgFv+sBkKh523Nx0YtuGgmGuuVTaD27G2inwgFDabUs
        AKISBbn6d6jwlkfk3D+O6h5pdLqoI64Zq/NPmD0oWsupn2HVhMSjFbE6dwIDAQAB
        AoGAJDRGHp3IASNsu4V5k4QJuqF+jkqhl+S4Zyzn939/+3ydu1c5xl+/53fC7+O1
        j93RXXN7vF5LV11FfgSqwe/5wDEcAtyLXWPCHtLB1CIYFfqHxgwOQm4gQSyOgBnP
        hMccyv0VCDK23+Mk37lLkuON6xXMC8+IUq5UW/aadxkeqoECQQDU9Z5IFCmp3Ibs
        hJXx/x+ZQI+gLj0hh71pQEO2zqhu19i+M62KKnDb7k2OtK9IJR2ucU+YE3SXGShh
        1sPmgfVfAkEAsaTtZ1oZmszOs5TPYhs2e7LKLPNADZ36GVsG2h1FHVX+LyNkwk/E
        pn+FV3Dd1vkzxG/a3znEKz+2BJiz4vF56QJATUxKA4euB8XQA5Gsi4Y7Bfl1KIMg
        FUeb7NQyv+wLHxChz4gaeYgmJu48oIvdA6bVOzhN17lYHHA5RCocOVL6qQJAdHdT
        6nmo5dO3BQfgO0rqGolqgbPtX8AeE3eZc3DTOluBrbf/vGF95UcfzedCmkmBxh0r
        m0SNN2mq1TKkZXq52QJAIjxhG7spkOSZJQnVBA9TfLYZFM/aUzDpLxflvFAuJuqJ
        l+PFsbek2Zl6fgy294dXRvQhp1PJryngDaXTBiWK6g==
        -----END RSA PRIVATE KEY-----
        